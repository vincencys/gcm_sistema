{% extends "base.html" %}
{% block content %}
<div class="flex justify-between items-center mb-4 flex-col gap-2 sm:flex-row sm:gap-0">
    <h2 class="text-xl font-bold text-indigo-800">Lista de Apreensões</h2>
    {% if bo %}
    <a href="{% url 'bogcmi:editar' bo.pk %}" class="px-4 py-2 rounded bg-slate-600 text-white font-bold w-full sm:w-auto text-center">Voltar</a>
    {% else %}
    <a href="{% url 'bogcmi:novo' %}" class="px-4 py-2 rounded bg-slate-600 text-white font-bold w-full sm:w-auto text-center">Voltar</a>
    {% endif %}
</div>
<a href="{% url 'bogcmi:apreensao_form' %}{% if bo %}?bo={{ bo.pk }}{% endif %}" class="px-4 py-2 rounded bg-indigo-600 text-white font-bold mb-4 inline-block w-full sm:w-auto text-center">Adicionar Apreensão</a>
{# Mobile: cards #}
<div class="md:hidden space-y-3">
    {% for ap in apreensoes %}
    <div class="bg-white border rounded-xl p-3 shadow-sm">
        <div class="flex items-start justify-between gap-3">
            <div class="min-w-0">
                <div class="text-xs text-slate-500">Apreensão</div>
                <div class="mt-1 font-semibold truncate">{{ ap.descricao }}</div>
                <div class="text-xs text-slate-600 mt-0.5">{{ ap.unidade_medida }} • Qtde: {{ ap.quantidade }}</div>
            </div>
        </div>

        <div class="mt-2 space-y-1 text-sm break-words">
            <div class="flex justify-between gap-3"><span class="text-slate-500">Destino</span><span class="text-right truncate max-w-[60%]">{{ ap.destino }}</span></div>
            <div class="flex justify-between gap-3"><span class="text-slate-500">Recebedor</span><span class="text-right truncate max-w-[60%]">{{ ap.recebedor }}</span></div>
        </div>

        <div class="mt-3 space-y-1">
            <a href="{% url 'bogcmi:apreensao_anexo_form' ap.id %}{% if bo %}?bo={{ bo.pk }}{% endif %}" class="inline-flex items-center h-9 px-3 border rounded bg-indigo-50 text-indigo-700 hover:bg-indigo-100 w-full sm:w-auto justify-center">Adicionar Anexo</a>
            <ul class="mt-2 space-y-1">
                {% for anexo in ap.anexos.all %}
                <li class="flex items-center justify-between text-xs bg-slate-50 p-2 rounded">
                    <span class="truncate">{{ anexo.descricao }}</span>
                    <span class="flex gap-2 ml-2">
                        <a href="{{ anexo.arquivo.url }}" target="_blank" class="text-blue-600 hover:underline">Abrir</a>
                        <a href="{{ anexo.arquivo.url }}" download class="text-emerald-600 hover:underline">Baixar</a>
                        <a href="{% url 'bogcmi:apreensao_anexo_excluir' anexo.id %}{% if bo %}?bo={{ bo.pk }}{% endif %}" onclick="return confirm('Confirma apagar?')" class="text-rose-600 hover:underline">Excluir</a>
                    </span>
                </li>
                {% empty %}
                <li class="text-slate-500 text-xs">Nenhum anexo</li>
                {% endfor %}
            </ul>
        </div>

        <div class="mt-3 grid grid-cols-1 gap-2">
            <a href="{% url 'bogcmi:apreensao_excluir' ap.id %}{% if bo %}?bo={{ bo.pk }}{% endif %}" onclick="return confirm('Confirma apagar?')" class="inline-flex items-center justify-center h-9 px-3 rounded border bg-rose-50 text-rose-700 hover:bg-rose-100">Excluir</a>
        </div>
    </div>
    {% empty %}
      <div class="text-center text-slate-500">Nenhuma apreensão cadastrada.</div>
    {% endfor %}
</div>

{# Desktop: tabela #}
<div class="hidden md:block overflow-x-auto">
<table class="min-w-full bg-white border rounded-xl shadow">
    <thead class="bg-indigo-50">
        <tr>
            <th class="px-4 py-2 border-b text-indigo-700">Descrição</th>
            <th class="px-4 py-2 border-b text-indigo-700">Unidade</th>
            <th class="px-4 py-2 border-b text-indigo-700">Quantidade</th>
            <th class="px-4 py-2 border-b text-indigo-700">Destino</th>
            <th class="px-4 py-2 border-b text-indigo-700">Recebedor</th>
            <th class="px-4 py-2 border-b text-indigo-700">Anexos</th>
            <th class="px-4 py-2 border-b text-indigo-700">Ações</th>
        </tr>
    </thead>
    <tbody>
        {% for ap in apreensoes %}
        <tr class="hover:bg-indigo-50">
            <td class="border-b px-4 py-2">{{ ap.descricao }}</td>
            <td class="border-b px-4 py-2">{{ ap.unidade_medida }}</td>
            <td class="border-b px-4 py-2">{{ ap.quantidade }}</td>
            <td class="border-b px-4 py-2">{{ ap.destino }}</td>
            <td class="border-b px-4 py-2">{{ ap.recebedor }}</td>
            <td class="border-b px-4 py-2">
                <a href="{% url 'bogcmi:apreensao_anexo_form' ap.id %}{% if bo %}?bo={{ bo.pk }}{% endif %}" class="px-2 py-1 rounded bg-purple-600 text-white">Adicionar Anexo</a>
                <ul class="mt-2">
                {% for anexo in ap.anexos.all %}
                    <li class="flex items-center gap-2">
                        <span>{{ anexo.descricao }}</span>
                        <a href="{{ anexo.arquivo.url }}" target="_blank" class="text-blue-600 underline">Abrir</a>
                        <a href="{{ anexo.arquivo.url }}" download class="text-green-600 underline">Baixar</a>
                        <a href="{% url 'bogcmi:apreensao_anexo_excluir' anexo.id %}{% if bo %}?bo={{ bo.pk }}{% endif %}" onclick="return confirm('Confirma apagar?')" class="text-red-600 underline">Excluir</a>
                    </li>
                {% empty %}
                    <li class="text-slate-500">Nenhum anexo</li>
                {% endfor %}
                </ul>
            </td>
            <td class="border-b px-4 py-2">
                <a href="{% url 'bogcmi:apreensao_excluir' ap.id %}{% if bo %}?bo={{ bo.pk }}{% endif %}" onclick="return confirm('Confirma apagar?')" class="px-2 py-1 rounded bg-red-600 text-white">Excluir</a>
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="7" class="text-center text-slate-500">Nenhuma apreensão cadastrada.</td></tr>
        {% endfor %}
    </tbody>
</table>
</div>
{% endblock %}
