{% extends "_layout/base.html" %}
{% block title %}Banco de Horas · Lançamentos{% endblock %}
{% block content %}
<!-- Header -->
<div class="mb-6 bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden">
  <div class="px-4 py-3 flex items-center justify-between" style="background:#f1f5f9;border-bottom:1px solid #e5e7eb;">
    <div class="flex items-center gap-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-sky-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      <h1 class="text-xl font-bold text-slate-800">Banco de Horas · Lançamentos</h1>
    </div>
  </div>
</div>

<div class="mb-4 p-3 border rounded bg-white">
  <div class="text-sm text-slate-700">Usuário</div>
  <div class="font-medium">{{ alvo.get_full_name|default:alvo.username }}</div>
  {% if perfil and perfil.matricula %}
  <div class="text-slate-600 text-sm">Matrícula: {{ perfil.matricula }}</div>
  {% endif %}
</div>

<form method="get" class="mb-4 grid grid-cols-1 md:grid-cols-5 gap-3 items-end">
  <div>
    <label class="block text-sm text-slate-600 mb-1">Origem</label>
    <select name="origem" class="border rounded px-3 py-2 w-full">
      <option value="">(Todas)</option>
      {% for value,label in ORIGEM_CHOICES %}
        <option value="{{ value }}" {% if origem == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label class="block text-sm text-slate-600 mb-1">De</label>
    <input type="date" name="de" value="{{ de }}" class="border rounded px-3 py-2 w-full" />
  </div>
  <div>
    <label class="block text-sm text-slate-600 mb-1">Até</label>
    <input type="date" name="ate" value="{{ ate }}" class="border rounded px-3 py-2 w-full" />
  </div>
  <div>
    <label class="block text-sm text-slate-600 mb-1">Buscar</label>
    <input type="text" name="q" value="{{ q }}" placeholder="Motivo, Ref. ou Criador" class="border rounded px-3 py-2 w-full" />
  </div>
  <div>
    <button class="bg-blue-600 text-white px-4 py-2 rounded w-full">Filtrar</button>
  </div>
</form>

<div class="mb-3 flex justify-end">
  <a class="inline-flex items-center bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-2 rounded" href="?{{ base_query }}{% if base_query %}&{% endif %}export=csv">Exportar CSV</a>
  
</div>

<div class="overflow-x-auto border rounded">
  <table class="min-w-full text-sm border-separate border-spacing-0">
    <thead>
      <tr class="bg-slate-100 text-left">
        <th class="px-3 py-2 border-r border-gray-300 last:border-r-0">Data/Hora</th>
        <th class="px-3 py-2 border-r border-gray-300 last:border-r-0">Origem</th>
        <th class="px-3 py-2 border-r border-gray-300 last:border-r-0">Minutos</th>
        <th class="px-3 py-2 border-r border-gray-300 last:border-r-0">HH:MM</th>
        <th class="px-3 py-2 border-r border-gray-300 last:border-r-0">Motivo</th>
        <th class="px-3 py-2 border-r border-gray-300 last:border-r-0">Criado por</th>
        <th class="px-3 py-2 border-r border-gray-300 last:border-r-0">Ref.</th>
      </tr>
    </thead>
    <tbody>
      {% if items %}
        {% for l in items %}
        <tr>
          <td class="px-3 py-2 whitespace-nowrap border-t border-gray-200 border-r border-gray-300 last:border-r-0">{{ l.created_at|date:"d/m/Y H:i" }}</td>
          <td class="px-3 py-2 border-t border-gray-200 border-r border-gray-300 last:border-r-0">{{ l.origem }}</td>
          <td class="px-3 py-2 font-mono border-t border-gray-200 border-r border-gray-300 last:border-r-0">{% if l.minutos >= 0 %}+{% endif %}{{ l.minutos }}</td>
          <td class="px-3 py-2 font-mono border-t border-gray-200 border-r border-gray-300 last:border-r-0">{{ l.hhmm }}</td>
          <td class="px-3 py-2 border-t border-gray-200 border-r border-gray-300 last:border-r-0">{{ l.motivo }}</td>
          <td class="px-3 py-2 border-t border-gray-200 border-r border-gray-300 last:border-r-0">{{ l.created_by }}</td>
          <td class="px-3 py-2 border-t border-gray-200 border-r border-gray-300 last:border-r-0">{{ l.ref_type }}{% if l.ref_id %} #{{ l.ref_id }}{% endif %}</td>
        </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="7" class="px-3 py-4 text-slate-500">Nenhum lançamento encontrado para os filtros.</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>

<div class="mt-3">
  {% include '_partials/pagination.html' with page_obj=page_obj extra_query=extra_query %}
</div>

<div class="mt-6">
  <a href="{% url 'core:banco_de_horas' %}" class="text-blue-700 underline">Voltar ao Banco de Horas</a>
</div>
{% endblock %}
