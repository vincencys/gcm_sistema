{% load humanize %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <title>BO · Estatísticas ({{ de|date:'d/m/Y' }} — {{ ate|date:'d/m/Y' }})</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif; margin: 24px; color:#0f172a; }
    h1 { margin: 0 0 4px 0; font-size: 22px; }
    h2 { margin: 18px 0 8px; font-size: 16px; }
    .muted { color:#64748b; }
    .grid { display: grid; gap: 12px; }
    .kpis { grid-template-columns: repeat(4, minmax(0,1fr)); }
    .card { border:1px solid #e2e8f0; border-radius:8px; padding:12px; }
    .k { font-size: 11px; color:#64748b; }
    .v { font-size: 24px; font-weight: 700; }
    table { width: 100%; border-collapse: collapse; font-size: 12px; }
    th, td { padding: 6px 8px; border-bottom: 1px solid #e2e8f0; text-align: left; }
    th { color:#64748b; font-weight: 600; }
    .cols-2 { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .cols-3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    .badge { display:inline-block; padding: 3px 8px; border-radius: 999px; background:#eef2ff; color:#3730a3; font-weight:600; font-size:12px; }
    .dv { background:#ffe4e6; color:#9f1239; }
    .small { font-size: 11px; }
  </style>
</head>
<body>
  <div style="display:flex;align-items:center;justify-content:space-between;">
    <div>
      <h1>Estatísticas de BO (BOGCMI)</h1>
      <div class="muted small">Período: {{ de|date:'d/m/Y' }} a {{ ate|date:'d/m/Y' }} · Aba: {{ tab|title }}</div>
    </div>
    <div><span class="badge">Apresentação</span></div>
  </div>

  <!-- KPIs principais -->
  <div class="grid kpis" style="margin-top:14px;">
    <div class="card"><div class="k">Total de BOs</div><div class="v">{{ total|intcomma }}</div></div>
    <div class="card"><div class="k">Finalizados</div><div class="v">{{ finalizados|intcomma }}</div></div>
    <div class="card"><div class="k">Em edição</div><div class="v">{{ abertos|intcomma }}</div></div>
    <div class="card"><div class="k">Offline</div><div class="v">{{ offline|intcomma }}</div></div>
  </div>

  <div class="cols-2" style="margin-top:16px;">
    <div class="card">
      <h2>Por Status</h2>
      <table>
        <thead><tr><th>Status</th><th>Qtde</th></tr></thead>
        <tbody>
          {% for s in por_status %}
            <tr><td>{{ s.status }}</td><td>{{ s.qtd|intcomma }}</td></tr>
          {% empty %}
            <tr><td colspan="2" class="muted">Sem registros.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="card">
      <h2>DV Contra Mulher</h2>
      <div class="grid" style="grid-template-columns: repeat(3, minmax(0,1fr)); gap:10px;">
        <div>
          <div class="k">Total DV</div>
          <div class="v" style="color:#9f1239;">{{ dv_total|intcomma }}</div>
        </div>
        <div>
          <div class="k">Participação no período</div>
          <div class="v" style="color:#9f1239;">{{ dv_percent }}%</div>
        </div>
        <div>
          <div class="k">Flagrantes (geral)</div>
          <div class="v">{{ flagrantes|intcomma }}</div>
        </div>
      </div>
      <div class="small muted" style="margin-top:6px;">Critérios DV: código A-18 ou natureza contendo "mulher"/"maria da penha".</div>
    </div>
  </div>

  <div class="cols-2" style="margin-top:16px;">
    <div class="card">
      <h2>Top Códigos</h2>
      <table>
        <thead><tr><th>Código</th><th>Natureza</th><th>Qtde</th></tr></thead>
        <tbody>
          {% for r in ranking_codigos %}
            <tr><td>{{ r.cod_natureza|default:'—' }}</td><td>{{ r.natureza|default:'(sem descrição)' }}</td><td>{{ r.qtd|intcomma }}</td></tr>
          {% empty %}
            <tr><td colspan="3" class="muted">Sem registros.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="card">
      <h2>Top Usuários</h2>
      <table>
        <thead><tr><th>Usuário</th><th>Total</th></tr></thead>
        <tbody>
          {% for u in users_ranking %}
            <tr><td>{{ u.nome }}</td><td>{{ u.total|intcomma }}</td></tr>
          {% empty %}
            <tr><td colspan="2" class="muted">Sem registros.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="muted small" style="margin-top:10px;">Arquivo gerado para apresentação. Fonte: Sistema GCM · BO (BOGCMI).</div>
</body>
</html>
