{% extends '_layout/base.html' %}
{% block content %}
<div class="max-w-7xl mx-auto">
  <!-- Header -->
  <div class="mb-6 bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden">
    <div class="px-4 py-3 flex items-center justify-between" style="background:#f1f5f9;border-bottom:1px solid #e5e7eb;">
      <div class="flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        <h1 class="text-xl font-bold text-slate-800">Assistidas Pendentes de ValidaÃ§Ã£o</h1>
      </div>
      <a href="{% url 'panic:assistida_criar' %}" class="px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm">+ Adicionar Assistida</a>
    </div>
  </div>

  <!-- Filtros AvanÃ§ados -->
  <form method="get" class="mb-4 bg-gray-50 p-4 rounded border">
    <h3 class="font-semibold mb-2 text-sm">ğŸ” Busca AvanÃ§ada</h3>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
      <div class="flex flex-col">
        <label class="text-xs font-semibold">Nome</label>
        <input type="text" name="nome" value="{{ nome }}" placeholder="Ex: Maria" class="border rounded px-2 py-1" />
      </div>
      <div class="flex flex-col">
        <label class="text-xs font-semibold">CPF</label>
        <input type="text" name="cpf" value="{{ cpf }}" placeholder="Ex: 123.456" class="border rounded px-2 py-1" />
      </div>
      <div class="flex flex-col">
        <label class="text-xs font-semibold">Telefone</label>
        <input type="text" name="telefone" value="{{ telefone }}" placeholder="Ex: 5468" class="border rounded px-2 py-1" />
      </div>
      <div class="flex flex-col">
        <label class="text-xs font-semibold">Processo MP</label>
        <input type="text" name="processo" value="{{ processo }}" placeholder="Ex: 64686437" class="border rounded px-2 py-1" />
      </div>
    </div>
    <div class="flex gap-2 mt-3">
      <button class="btn btn-primary px-3 py-1">Filtrar</button>
      <a href="?" class="text-xs text-gray-600 underline self-center">Limpar</a>
    </div>
  </form>

  {# Lista MOBILE: cards verticais (somente telas pequenas) #}
  <div class="md:hidden space-y-3">
    {% for a in page_obj %}
      <div class="bg-white border rounded-xl p-3 shadow-sm overflow-hidden border-l-4 border-yellow-500">
        <div class="flex items-start justify-between gap-2">
          <div class="min-w-0">
            <div class="text-xs text-slate-500">Assistida Pendente <b>#{{ a.id }}</b></div>
            <div class="mt-1 font-semibold truncate">{{ a.nome }}</div>
            <div class="text-xs text-gray-500">CPF {{ a.cpf }}</div>
            {% if a.telefone %}<div class="text-xs text-gray-600">Tel {{ a.telefone }}</div>{% endif %}
          </div>
          <div class="shrink-0">
            <span class="inline-block px-2 py-1 rounded text-xs font-semibold bg-yellow-500 text-black">Pendente</span>
          </div>
        </div>

        <div class="mt-2 space-y-1 text-sm break-words">
          <div class="flex justify-between gap-3"><span class="text-slate-500">Processo MP</span><span>{{ a.processo_mp }}</span></div>
          <div class="flex justify-between gap-3"><span class="text-slate-500">Cadastrado em</span><span>{{ a.created_at|date:'d/m/Y H:i' }}</span></div>
        </div>

        <div class="mt-3 flex flex-col gap-2">
          <div class="grid grid-cols-2 gap-1">
            <a href="{% url 'panic:assistida_aprovar' a.pk %}" class="inline-flex items-center justify-center h-9 px-3 rounded bg-green-600 text-white text-xs">âœ“ Aprovar</a>
            <a href="{% url 'panic:assistida_reprovar' a.pk %}" class="inline-flex items-center justify-center h-9 px-3 rounded bg-red-600 text-white text-xs">âœ— Reprovar</a>
          </div>
          {% if a.documento_mp %}
            <a href="{{ a.documento_mp.url }}" target="_blank" class="inline-flex items-center justify-center h-9 px-3 border rounded bg-blue-50 text-blue-700 text-xs">ğŸ“„ Ver Documento</a>
          {% endif %}
        </div>
      </div>
    {% empty %}
      <div class="text-center text-slate-500 py-8">Nenhuma assistida pendente encontrada.</div>
    {% endfor %}

    {# PaginaÃ§Ã£o mobile #}
    {% if page_obj.has_other_pages %}
    <div class="flex items-center justify-center text-sm mt-4">
      <div class="flex gap-1 items-center">
        {% if page_obj.has_previous %}
          <a class="px-2 py-1 border rounded hover:bg-slate-50" href="?page=1{% if nome %}&nome={{ nome }}{% endif %}{% if cpf %}&cpf={{ cpf }}{% endif %}{% if telefone %}&telefone={{ telefone }}{% endif %}{% if processo %}&processo={{ processo }}{% endif %}">Â«</a>
          <a class="px-2 py-1 border rounded hover:bg-slate-50" href="?page={{ page_obj.previous_page_number }}{% if nome %}&nome={{ nome }}{% endif %}{% if cpf %}&cpf={{ cpf }}{% endif %}{% if telefone %}&telefone={{ telefone }}{% endif %}{% if processo %}&processo={{ processo }}{% endif %}">â€¹</a>
        {% else %}
          <span class="px-2 py-1 border rounded opacity-40 select-none">Â«</span>
          <span class="px-2 py-1 border rounded opacity-40 select-none">â€¹</span>
        {% endif %}
        <span class="px-2 py-1 border rounded bg-slate-50 select-none">PÃ¡gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}
          <a class="px-2 py-1 border rounded hover:bg-slate-50" href="?page={{ page_obj.next_page_number }}{% if nome %}&nome={{ nome }}{% endif %}{% if cpf %}&cpf={{ cpf }}{% endif %}{% if telefone %}&telefone={{ telefone }}{% endif %}{% if processo %}&processo={{ processo }}{% endif %}">â€º</a>
          <a class="px-2 py-1 border rounded hover:bg-slate-50" href="?page={{ page_obj.paginator.num_pages }}{% if nome %}&nome={{ nome }}{% endif %}{% if cpf %}&cpf={{ cpf }}{% endif %}{% if telefone %}&telefone={{ telefone }}{% endif %}{% if processo %}&processo={{ processo }}{% endif %}">Â»</a>
        {% else %}
          <span class="px-2 py-1 border rounded opacity-40 select-none">â€º</span>
          <span class="px-2 py-1 border rounded opacity-40 select-none">Â»</span>
        {% endif %}
      </div>
    </div>
    {% endif %}
  </div>

  {# Desktop: tabela existente #}
  <div class="hidden md:block">
  <!-- Tabela -->
  <table class="min-w-full text-sm border border-slate-300 border-collapse">
    <thead class="bg-yellow-100">
      <tr>
        <th class="p-2 text-left border border-slate-300">ID</th>
        <th class="p-2 text-left border border-slate-300">Nome</th>
        <th class="p-2 text-left border border-slate-300">CPF</th>
        <th class="p-2 text-left border border-slate-300">Telefone</th>
        <th class="p-2 text-left border border-slate-300">Processo MP</th>
        <th class="p-2 text-left border border-slate-300">Cadastrado em</th>
        <th class="p-2 text-left border border-slate-300">AÃ§Ãµes</th>
      </tr>
    </thead>
    <tbody>
    {% for a in page_obj %}
      <tr class="hover:bg-gray-50">
        <td class="p-2 border border-slate-200">{{ a.id }}</td>
        <td class="p-2 border border-slate-200">{{ a.nome }}</td>
        <td class="p-2 border border-slate-200">{{ a.cpf }}</td>
        <td class="p-2 border border-slate-200">{{ a.telefone }}</td>
        <td class="p-2 border border-slate-200">{{ a.processo_mp }}</td>
        <td class="p-2 border border-slate-200">{{ a.created_at|date:'d/m/Y H:i' }}</td>
        <td class="p-2 space-x-1 border border-slate-200">
          <a href="{% url 'panic:assistida_aprovar' a.pk %}" class="btn btn-success btn-sm">âœ“ Aprovar</a>
          <a href="{% url 'panic:assistida_reprovar' a.pk %}" class="btn btn-danger btn-sm">âœ— Reprovar</a>
          {% if a.documento_mp %}
            <a href="{{ a.documento_mp.url }}" target="_blank" class="text-xs text-blue-600">ğŸ“„ Ver Doc</a>
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="7" class="p-4 text-center text-gray-500 border border-slate-200">Nenhuma assistida pendente encontrada.</td></tr>
    {% endfor %}
    </tbody>
  </table>

  <!-- PaginaÃ§Ã£o -->
  {% if page_obj.has_other_pages %}
  <div class="flex justify-center items-center gap-2 mt-4">
    {% if page_obj.has_previous %}
      <a href="?page=1{% if nome %}&nome={{ nome }}{% endif %}{% if cpf %}&cpf={{ cpf }}{% endif %}{% if telefone %}&telefone={{ telefone }}{% endif %}{% if processo %}&processo={{ processo }}{% endif %}" 
         class="px-3 py-1 border rounded hover:bg-gray-100">Â« Primeira</a>
      <a href="?page={{ page_obj.previous_page_number }}{% if nome %}&nome={{ nome }}{% endif %}{% if cpf %}&cpf={{ cpf }}{% endif %}{% if telefone %}&telefone={{ telefone }}{% endif %}{% if processo %}&processo={{ processo }}{% endif %}" 
         class="px-3 py-1 border rounded hover:bg-gray-100">â€¹ Anterior</a>
    {% endif %}
    
    <span class="px-3 py-1 font-semibold">
      PÃ¡gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
    </span>
    
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% if nome %}&nome={{ nome }}{% endif %}{% if cpf %}&cpf={{ cpf }}{% endif %}{% if telefone %}&telefone={{ telefone }}{% endif %}{% if processo %}&processo={{ processo }}{% endif %}" 
         class="px-3 py-1 border rounded hover:bg-gray-100">PrÃ³xima â€º</a>
      <a href="?page={{ page_obj.paginator.num_pages }}{% if nome %}&nome={{ nome }}{% endif %}{% if cpf %}&cpf={{ cpf }}{% endif %}{% if telefone %}&telefone={{ telefone }}{% endif %}{% if processo %}&processo={{ processo }}{% endif %}" 
         class="px-3 py-1 border rounded hover:bg-gray-100">Ãšltima Â»</a>
    {% endif %}
  </div>
  <p class="text-center text-xs text-gray-500 mt-2">
    Exibindo {{ page_obj.start_index }} a {{ page_obj.end_index }} de {{ page_obj.paginator.count }} resultados
  </p>
  {% endif %}
  </div>
</div>
{% endblock %}
