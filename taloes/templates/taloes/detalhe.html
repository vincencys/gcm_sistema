{% extends "_layout/base.html" %}

{% block content %}
<h1 class="text-xl font-semibold mb-4">Talão #{{ talao.pk }}</h1>

<div class="space-y-1 mb-4">
  <div>Viatura: <b>{{ talao.viatura.prefixo }}</b></div>
  <div>Status: <span class="badge {% if talao.status == 'ABERTO' %}badge-success{% else %}badge{% endif %}">{{ talao.status }}</span></div>
  <div>Início: {{ talao.iniciado_em|date:"d/m/Y H:i" }}</div>
  {% if talao.encerrado_em %}<div>Fim: {{ talao.encerrado_em|date:"d/m/Y H:i" }}</div>{% endif %}
  <div>KM: {{ talao.km_inicial }}{% if talao.km_final %} → {{ talao.km_final }}{% endif %}</div>
  {% if talao.codigo_ocorrencia %}
    <div>
      Ocorrência: <b>{{ talao.codigo_ocorrencia.sigla }}</b> — {{ talao.codigo_ocorrencia.descricao }}
      {% if talao.local_bairro %}<span class="text-slate-500">({{ talao.local_bairro }})</span>{% endif %}
    </div>
  {% endif %}
</div>

<div class="flex gap-3 mb-6">
  <a class="btn" href="{% url 'taloes:editar_ocorrencia' talao.pk %}">Editar ocorrência</a>
  <form method="post" action="{% url 'taloes:finalizar' talao.pk %}">
    {% csrf_token %}
    {{ form_finalizar.km_final }}
    <button class="btn btn-danger" {% if talao.status == 'FECHADO' %}disabled{% endif %}>Finalizar</button>
  </form>
</div>

<h2 class="text-lg font-medium mb-2">Relatório</h2>
<form method="post" action="">
  {% csrf_token %}
  {{ form_relatorio.relatorio }}
  <button class="btn mt-2">Salvar relatório</button>
</form>

{% endblock %}
